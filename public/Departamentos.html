<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Departamentos - Carbonora</title>
    <meta name="description" content="Información sobre los departamentos de la empresa Carbonora.">
    <meta name="keywords" content="departamentos, minería, Carbonora, empresa">
    <script src="auth-guard.js"></script>
    <link rel="stylesheet" href="carbonora.css">
    <link rel="stylesheet" href="Departamentos.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    <!-- Sidebar EXACTAMENTE como la tienes -->
    <nav class="sidebar close">
        <header>
            <div class="image-text">
                <span class="image">
                    <img src="Imagenes/logo-arizona.jpg" alt="LOGO">
                </span>
                <div class="text header-text">
                    <span class="name">Carbonora</span>
                    <span class="profesion">RH</span>
                </div>
            </div>
            <i class='bx bx-chevron-right toggle'></i>
        </header>
        <div class="menu-bar">
            <div class="menu">
                <li class="search-box">
                    <i class='bx bx-search icon'></i>
                    <input type="text" placeholder="Buscar...">
                </li>
                <ul class="menu-links">
                    <li class="nav-link">
                        <a href="Inicio.html">
                            <i class='bx bx-home-alt icon'></i>
                            <span class="text nav-text">Inicio</span>
                        </a>
                    </li>
                    <li class="nav-link">
                        <a href="Empleados.html">
                            <i class='bx bxs-user-detail icon'></i>
                            <span class="text nav-text">Empleados</span>
                        </a>
                        <ul class="SubEmpleados">
                            <li><a href="Gerente.html">Gerente</a></li>
                            <li><a href="Departamentos.html">Departamentos</a></li>
                            <li><a href="Areas.html">Áreas</a></li>
                        </ul>
                    </li>
                    <li class="nav-link">
                        <a href="notificaciones.html">
                            <i class='bx bx-bell icon'></i>
                            <span class="text nav-text">Notificaciones</span>
                        </a>
                    </li>
                    <li class="nav-link">
                        <a href="estadisticas.html">
                            <i class='bx bx-pie-chart-alt icon'></i>
                            <span class="text nav-text">Estadísticas</span>
                        </a>
                    </li>
                    <li class="nav-link">
                        <a href="PQRS.html">
                            <i class='bx bx-comment-error icon'></i>
                            <span class="text nav-text">PQRS</span>
                        </a>
                    </li>
                    <li class="nav-link">
                        <a href="soporte.html">
                            <i class='bx bx-help-circle icon'></i>
                            <span class="text nav-text">Soporte</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="bottom-content">
                <li>
                    <a href="index.html">
                        <i class='bx bx-log-out icon'></i>
                        <span class="text nav-text">Salir</span>
                    </a>
                </li>
                <li class="mode">
                    <div class="sun-moon">
                        <i class='bx bx-moon icon moon'></i>
                        <i class='bx bx-sun icon sun'></i>
                    </div>
                    <span class="mode-text text">Modo oscuro</span>
                    <div class="toggle-switch">
                        <span class="switch"></span>
                    </div>
                </li>
            </div>
        </div>
    </nav>

    <div class="departamentos">
        <h1>Departamentos de la Empresa</h1>
        <p>En Carbonora, los departamentos son fundamentales para garantizar el éxito de nuestras operaciones. Aquí puedes consultar la información general de cada uno.</p>
        <table id="tablaDepartamentos">
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Nombre</th>
                    <th>Adm-Ing</th>
                    <th>Código Área</th>
                </tr>
            </thead>
            <tbody>
                <!-- Los datos se cargarán dinámicamente -->
            </tbody>
        </table>
    </div>
    <script>
        // Función auxiliar para obtener headers con token
        function getAuthHeaders() {
          const token = localStorage.getItem('authToken');
          return {
            'Content-Type': 'application/json',
            'Authorization': token ? `Bearer ${token}` : ''
          };
        }

        // Cargar los departamentos desde el backend y mostrarlos en la tabla
        async function cargarDepartamentos() {
            const tbody = document.querySelector('#tablaDepartamentos tbody');
            tbody.innerHTML = '';
            try {
                const res = await fetch('/departamentos', { headers: getAuthHeaders() });
                const data = await res.json();
                data.forEach(dep => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${dep.CODIGODPTO || ''}</td>
                        <td>${dep.NOMBRE || ''}</td>
                        <td>${dep['Adm-Ing'] || ''}</td>
                        <td>${dep.AREAS_CODIGOAREAS || ''}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (err) {
                tbody.innerHTML = '<tr><td colspan="4">No se pudo cargar la información.</td></tr>';
            }
        }
        document.addEventListener('DOMContentLoaded', cargarDepartamentos);

        // ======= Sidebar Script (igual que en otras páginas) =======
        const sidebar   = document.querySelector('.sidebar');
        const toggleBtn = document.querySelector('.toggle');

        // Ítem Empleados y su submenú
        const empleadosItem = document.querySelector('.nav-link a[href="Empleados.html"]').parentElement;
        const submenu = empleadosItem.querySelector('.SubEmpleados');

        // Sidebar: Hover general
        sidebar.addEventListener('mouseenter', () => {
            if (!sidebar.classList.contains('pinned')) {
                sidebar.classList.remove('close');
            }
        });
        sidebar.addEventListener('mouseleave', () => {
            if (!sidebar.classList.contains('pinned')) {
                sidebar.classList.add('close');
            }
        });

        // Botón Toggle (fijar/desfijar)
        toggleBtn.addEventListener('click', () => {
            if (sidebar.classList.contains('pinned')) {
                sidebar.classList.remove('pinned');
                sidebar.classList.add('close');
            } else {
                sidebar.classList.remove('close');
                sidebar.classList.add('pinned');
            }
        });

        // Hover en "Empleados" para expandir la barra y mostrar submenú
        empleadosItem.addEventListener('mouseenter', () => {
            if (sidebar.classList.contains('close')) {
                sidebar.classList.remove('close');
            }
            submenu.style.display = 'block';
        });

        // Mantener submenú abierto mientras el mouse está sobre él
        let isOverSubmenu = false;
        submenu.addEventListener('mouseenter', () => {
            isOverSubmenu = true;
        });
        submenu.addEventListener('mouseleave', () => {
            isOverSubmenu = false;
            submenu.style.display = 'none';
            if (!sidebar.classList.contains('pinned')) {
                sidebar.classList.add('close');
            }
        });

        // Al salir del ítem "Empleados", retardo por si se mueve al submenú
        empleadosItem.addEventListener('mouseleave', () => {
            setTimeout(() => {
                if (!isOverSubmenu) {
                    submenu.style.display = 'none';
                    if (!sidebar.classList.contains('pinned')) {
                        sidebar.classList.add('close');
                    }
                }
            }, 150);
        });

        // Modo oscuro (opcional, si lo usas en otras páginas)
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.querySelector('body');
            const modeSwitch = document.querySelector('.toggle-switch');
            const modeText = document.querySelector('.mode-text');
            if (!modeSwitch || !modeText || !body) return;
            if (localStorage.getItem('theme') === 'dark') {
                body.classList.add('dark');
                modeText.innerText = 'Modo claro';
            }
            modeSwitch.addEventListener('click', () => {
                body.classList.toggle('dark');
                const isDark = body.classList.contains('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                modeText.innerText = isDark ? 'Modo claro' : 'Modo oscuro';
            });
        });
    </script>
</body>
</html>
