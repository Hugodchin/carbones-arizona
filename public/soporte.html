<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Web de Base de datos CARBONORA</title>
        <meta name="description" content="Base de datos de empleados de la empresa minera de carbones CARBONORA.">
        <meta name="keywords" content="datos, empleados, mineria, HTML, SEO">
        <script src="auth-guard.js"></script>
        <link rel="stylesheet" href="carbonora.css">
        <link rel="stylesheet" href="empleados.css">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <style>
            /* Animaciones */
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            @keyframes pulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.05); }
            }

            .soporte-header {
                text-align: center;
                padding: 40px 20px 20px;
                animation: fadeIn 0.8s ease-out;
            }

            .soporte-header h1 {
                color: #0D47A1;
                font-size: 2.5em;
                margin-bottom: 10px;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            }

            .soporte-header .icon-support {
                font-size: 4em;
                color: #1976D2;
                margin-bottom: 10px;
                animation: pulse 2s ease-in-out infinite;
            }

            .soporte-header p {
                color: #555;
                font-size: 1.1em;
            }

            .soporte-form-container {
                max-width: 500px;
                margin: 32px auto 0 auto;
                background: #fff;
                border-radius: 14px;
                box-shadow: 0 4px 24px #0002;
                padding: 28px 22px 18px 22px;
                animation: fadeInUp 0.8s ease-out 0.2s both;
            }
            .soporte-form-container h3 {
                color: #0D47A1;
                margin-bottom: 18px;
                text-align: center;
            }
            .soporte-form label {
                display: block;
                margin-bottom: 6px;
                font-weight: 500;
                animation: fadeInUp 0.6s ease-out both;
            }
            .soporte-form input, .soporte-form textarea, .soporte-form select {
                width: 100%;
                padding: 7px 10px;
                margin-bottom: 16px;
                border: 1px solid #bbb;
                border-radius: 6px;
                font-size: 1em;
                background: #fafafa;
                transition: all 0.3s ease;
            }
            .soporte-form input:focus, .soporte-form textarea:focus, .soporte-form select:focus {
                outline: none;
                border-color: #1976D2;
                box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
                transform: translateY(-2px);
            }
            .soporte-form textarea {
                min-height: 80px;
                resize: vertical;
            }
            .soporte-form button {
                background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%);
                color: #fff;
                border: none;
                border-radius: 6px;
                padding: 10px 24px;
                font-size: 1em;
                cursor: pointer;
                margin-right: 8px;
                transition: all 0.3s ease;
                box-shadow: 0 4px 12px rgba(13, 71, 161, 0.3);
            }
            .soporte-form button:hover {
                background: linear-gradient(135deg, #0D47A1 0%, #01579B 100%);
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(13, 71, 161, 0.4);
            }
            .soporte-form button:active {
                transform: translateY(0);
            }
            .soporte-form .success-msg, .soporte-form .error-msg {
                text-align: center;
                margin-bottom: 10px;
                font-weight: bold;
                padding: 10px;
                border-radius: 6px;
                animation: fadeInUp 0.5s ease-out;
            }
            .soporte-form .success-msg { 
                color: #2e7d32;
                background: rgba(46, 125, 50, 0.1);
                border: 1px solid #2e7d32;
            }
            .soporte-form .error-msg { 
                color: #c62828;
                background: rgba(198, 40, 40, 0.1);
                border: 1px solid #c62828;
            }
            
            /* Dark mode */
            body.dark .soporte-header h1 { color: #64B5F6; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
            body.dark .soporte-header p { color: #ccc; }
            body.dark .soporte-header .icon-support { color: #64B5F6; }
            body.dark .soporte-form-container { background: #232323; color: #f4f4f4; }
            body.dark .soporte-form input, body.dark .soporte-form textarea, body.dark .soporte-form select {
                background: #2d2d2d; color: #fff; border-color: #444;
            }
            body.dark .soporte-form input:focus, body.dark .soporte-form textarea:focus, body.dark .soporte-form select:focus {
                border-color: #64B5F6;
                box-shadow: 0 0 0 3px rgba(100, 181, 246, 0.2);
            }
            body.dark .soporte-form button { background: linear-gradient(135deg, #1976D2 0%, #0D47A1 100%); }
            body.dark .soporte-form button:hover { background: linear-gradient(135deg, #0D47A1 0%, #01579B 100%); }
            body.dark .soporte-form .success-msg { 
                color: #66BB6A;
                background: rgba(102, 187, 106, 0.15);
                border-color: #66BB6A;
            }
            body.dark .soporte-form .error-msg { 
                color: #EF5350;
                background: rgba(239, 83, 80, 0.15);
                border-color: #EF5350;
            }
        </style>
    </head>
<body>
    <div class="soporte-header">
        <i class='bx bx-support icon-support'></i>
        <h1>Centro de Soporte</h1>
        <p>¿Necesitas ayuda? Estamos aquí para ti</p>
    </div>

    <div class="soporte-form-container">
        <h3>Formulario de Soporte</h3>
        <form class="soporte-form" id="soporteForm">
            <div class="success-msg" id="soporte-success" style="display:none;"></div>
            <div class="error-msg" id="soporte-error" style="display:none;"></div>
            <label for="soporte-nombre">Nombre:</label>
            <input type="text" id="soporte-nombre" name="nombre" required>

            <label for="soporte-email">Correo electrónico:</label>
            <input type="email" id="soporte-email" name="email" required>

            <label for="soporte-tipo">Tipo de solicitud:</label>
            <select id="soporte-tipo" name="tipo" required>
                <option value="">Seleccione una opción</option>
                <option value="Pregunta">Pregunta</option>
                <option value="Queja">Queja</option>
                <option value="Reclamo">Reclamo</option>
                <option value="Sugerencia">Sugerencia</option>
                <option value="Soporte Técnico">Soporte Técnico</option>
                <option value="Problema con empleados">Problema con empleados</option>
                <option value="Problema con gráficos">Problema con gráficos</option>
                <option value="Problema con tablas">Problema con tablas</option>
                <option value="Otro">Otro</option>
            </select>

            <label for="soporte-asunto">Asunto:</label>
            <input type="text" id="soporte-asunto" name="asunto" required>

            <label for="soporte-mensaje">Mensaje:</label>
            <textarea id="soporte-mensaje" name="mensaje" required></textarea>

            <button type="submit">Enviar</button>
            <button type="reset">Limpiar</button>
        </form>
    </div>

    <footer>
        <p><em>Ayuda</em></p>
        <p><em>Contáctenos</em></p>
    </footer>
    <!-------------------------------------CREACION INICIO SIDE BAR---------------------------------------------------------->
<nav class="sidebar close">
    <header>
      <div class="image-text">
        <span class="image">
          <img src="Imagenes/logo-arizona.jpg" alt="LOGO">
        </span>
        <div class="text header-text">
          <span class="name">Carbonora</span>
          <span class="profesion" id="user-role">Cargando...</span>
        </div>
      </div>
      <i class='bx bx-chevron-right toggle'></i>
    </header>
    <div class="menu-bar">
      <div class="menu">
        <li class="search-box">
          <i class='bx bx-search icon'></i>
          <input type="text" placeholder="Buscar...">
        </li>
        <ul class="menu-links">
          <li class="nav-link">
            <a href="Inicio.html" id="inicio-link">
              <i class='bx bx-home-alt icon'></i>
              <span class="text nav-text">Inicio</span>
            </a>
          </li>
          
          <!-- Link de Contacto visible para invitados -->
          <li class="nav-link" id="contacto-link">
            <a href="contacto.html">
              <i class='bx bx-envelope icon'></i>
              <span class="text nav-text">Contacto</span>
            </a>
          </li>

          <!-- Link de Soporte visible para todos -->
          <li class="nav-link">
            <a href="soporte.html">
              <i class='bx bx-help-circle icon'></i>
              <span class="text nav-text">Soporte</span>
            </a>
          </li>

          <!-- ITEM EMPLEADOS (oculto para invitados) -->
          <li class="nav-link has-submenu" style="display:none" id="empleados-link">
            <a href="Empleados.html">
              <i class='bx bxs-user-detail icon'></i>
              <span class="text nav-text">Empleados</span>
            </a>
            <ul class="SubEmpleados">
              <li><a href="Gerente.html">Gerente</a></li>
              <li><a href="Departamentos.html">Departamentos</a></li>
              <li><a href="Areas.html">Áreas</a></li>
            </ul>
          </li>
          
          <li class="nav-link" style="display:none" id="notificaciones-link">
            <a href="notificaciones.html">
              <i class='bx bx-bell icon'></i>
              <span class="text nav-text">Notificaciones</span>
            </a>
          </li>
          
          <li class="nav-link" style="display:none" id="estadisticas-link">
            <a href="estadisticas.html">
              <i class='bx bx-pie-chart-alt icon'></i>
              <span class="text nav-text">Estadisticas</span>
            </a>
          </li>
          
          <li class="nav-link" style="display:none" id="pqrs-link">
            <a href="PQRS.html">
              <i class='bx bx-comment-error icon'></i>
              <span class="text nav-text">PQRS</span>
            </a>
          </li>
        </ul>
      </div>
      <div class="bottom-content">
        <li>
          <a href="index.html">
            <i class='bx bx-log-out icon'></i>
            <span class="text nav-text">Salir</span>
          </a>
        </li>
        <li class="mode">
          <div class="sun-moon">
            <i class='bx bx-moon icon moon'></i>
            <i class='bx bx-sun icon sun'></i>
          </div>
          <span class="mode-text text">Modo oscuro</span>
          <div class="toggle-switch">
            <span class="switch"></span>
          </div>
        </li>
      </div>
    </div>
  </nav>
  <button id="scrollTopBtn" title="Volver arriba">⬆</button>
    <script>
    // ======= Referencias =======
    const sidebar   = document.querySelector('.sidebar');
    const toggleBtn = document.querySelector('.toggle');

    // Ítem Empleados y su submenú
    const empleadosItem = document.querySelector('.nav-link a[href="Empleados.html"]').parentElement;
    const submenu = empleadosItem.querySelector('.SubEmpleados');

    // ======= Sidebar: Hover general =======
    sidebar.addEventListener('mouseenter', () => {
      if (!sidebar.classList.contains('pinned')) {
        sidebar.classList.remove('close');
      }
    });
    sidebar.addEventListener('mouseleave', () => {
      if (!sidebar.classList.contains('pinned')) {
        sidebar.classList.add('close');
      }
    });

    // ======= Botón Toggle (fijar/desfijar) =======
    toggleBtn.addEventListener('click', () => {
      if (sidebar.classList.contains('pinned')) {
        sidebar.classList.remove('pinned');
        sidebar.classList.add('close');
      } else {
        sidebar.classList.remove('close');
        sidebar.classList.add('pinned');
      }
    });

    // ======= Hover en "Empleados" para expandir la barra y mostrar submenú =======
    empleadosItem.addEventListener('mouseenter', () => {
      // Expandir la sidebar si está colapsada
      if (sidebar.classList.contains('close')) {
        sidebar.classList.remove('close');
      }
      // Mostrar el submenú
      submenu.style.display = 'block';
    });

    // ======= Lógica para mantener submenú abierto mientras el mouse está sobre él =======
    let isOverSubmenu = false;

    submenu.addEventListener('mouseenter', () => {
      isOverSubmenu = true;
    });
    submenu.addEventListener('mouseleave', () => {
      isOverSubmenu = false;
      submenu.style.display = 'none';
      if (!sidebar.classList.contains('pinned')) {
        sidebar.classList.add('close');
      }
    });

    // Al salir del ítem "Empleados", damos un pequeño retardo por si se mueve al submenú
    empleadosItem.addEventListener('mouseleave', () => {
      setTimeout(() => {
        if (!isOverSubmenu) {
          submenu.style.display = 'none';
          if (!sidebar.classList.contains('pinned')) {
            sidebar.classList.add('close');
          }
        }
      }, 150);
    });
    //Boton //
    const btn = document.getElementById("scrollTopBtn");

window.addEventListener('scroll', () => {
  btn.style.display = window.scrollY > 300 ? 'block' : 'none';
});

btn.addEventListener('click', () => {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

document.addEventListener('DOMContentLoaded', () => {
    const body = document.querySelector('body');
    const modeSwitch = document.querySelector('.toggle-switch');
    const modeText = document.querySelector('.mode-text');

    if (!modeSwitch || !modeText || !body) return;

    // Cargar modo desde localStorage
    if (localStorage.getItem('theme') === 'dark') {
        body.classList.add('dark');
        modeText.innerText = 'Modo claro';
    }

    // Cambiar entre modo oscuro y claro
    modeSwitch.addEventListener('click', () => {
        body.classList.toggle('dark');
        const isDark = body.classList.contains('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        modeText.innerText = isDark ? 'Modo claro' : 'Modo oscuro';
    });

    // Configurar sidebar según el rol del usuario
    const userRole = localStorage.getItem('userRole');
    const userRoleElement = document.getElementById('user-role');
    const inicioLink = document.getElementById('inicio-link');
    const contactoLink = document.getElementById('contacto-link');
    const empleadosLink = document.getElementById('empleados-link');
    const notificacionesLink = document.getElementById('notificaciones-link');
    const estadisticasLink = document.getElementById('estadisticas-link');
    const pqrsLink = document.getElementById('pqrs-link');

    if (userRole === 'invitado') {
        // Mostrar "Invitado" en el header
        if (userRoleElement) {
            userRoleElement.textContent = 'Invitado';
        }
        
        // Redirigir Inicio a inicio-invitado.html
        if (inicioLink) {
            inicioLink.querySelector('a').href = 'inicio-invitado.html';
        }
        
        // Mantener visible Contacto para invitados
        if (contactoLink) {
            contactoLink.style.display = '';
        }
        
        // Ocultar menús de admin
        if (empleadosLink) empleadosLink.style.display = 'none';
        if (notificacionesLink) notificacionesLink.style.display = 'none';
        if (estadisticasLink) estadisticasLink.style.display = 'none';
        if (pqrsLink) pqrsLink.style.display = 'none';
    } else {
        // Para rrhh y gerente
        if (userRoleElement) {
            userRoleElement.textContent = userRole === 'rrhh' ? 'RH' : 'Gerente';
        }
        
        // Inicio normal
        if (inicioLink) {
            inicioLink.querySelector('a').href = 'Inicio.html';
        }
        
        // Ocultar Contacto para usuarios admin
        if (contactoLink) {
            contactoLink.style.display = 'none';
        }
        
        // Mostrar menús de admin
        if (empleadosLink) empleadosLink.style.display = '';
        if (notificacionesLink) notificacionesLink.style.display = '';
        if (estadisticasLink) estadisticasLink.style.display = '';
        if (pqrsLink) pqrsLink.style.display = '';
    }
});    // Soporte: envío del formulario
    document.getElementById('soporteForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const nombre = document.getElementById('soporte-nombre').value.trim();
        const email = document.getElementById('soporte-email').value.trim();
        const tipo = document.getElementById('soporte-tipo').value;
        const asunto = document.getElementById('soporte-asunto').value.trim();
        const mensaje = document.getElementById('soporte-mensaje').value.trim();
        const successMsg = document.getElementById('soporte-success');
        const errorMsg = document.getElementById('soporte-error');
        successMsg.style.display = 'none';
        errorMsg.style.display = 'none';

        if (!nombre || !email || !tipo || !asunto || !mensaje) {
            errorMsg.textContent = "Todos los campos son obligatorios.";
            errorMsg.style.display = 'block';
            return;
        }

        try {
            const res = await fetch('http://localhost:3300/api/contacto', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    nombre,
                    email,
                    asunto: `[${tipo}] ${asunto}`,
                    mensaje
                })
            });
            const data = await res.json();
            if (res.ok) {
                successMsg.textContent = data.message || "Mensaje enviado correctamente.";
                successMsg.style.display = 'block';
                errorMsg.style.display = 'none';
                this.reset();
                // Notificación de soporte enviada
                try {
                    const notis = JSON.parse(localStorage.getItem('notificaciones_carbonora') || '[]');
                    notis.push({
                        tipo: 'added',
                        mensaje: `Se envió una solicitud de soporte: <b>${tipo}</b> - <b>${asunto}</b>`,
                        fecha: new Date().toLocaleString()
                    });
                    localStorage.setItem('notificaciones_carbonora', JSON.stringify(notis));
                    // Forzar actualización en otras pestañas y en esta
                    window.dispatchEvent(new Event('storage'));
                } catch (err) {
                    // Si localStorage falla, no afecta el envío del correo
                    console.error('No se pudo guardar la notificación local:', err);
                }
            } else {
                errorMsg.textContent = data.message || "Error al enviar el mensaje.";
                errorMsg.style.display = 'block';
            }
        } catch (err) {
            errorMsg.textContent = "Error al enviar el mensaje.";
            errorMsg.style.display = 'block';
        }
    });
    </script>
</body>
</html>